const xb={info:{program:"xdev_b is a tool for software development. Working in web browser side and co-working with xdev server side for seamless integration.",web:"",version:"0.1",contact:"mutita.org@gmail.com",date:"2023-06-13"},secure:{sessionId:sessionStorage.getItem("sessionId"),defaultSalt:"#|~}v4&u&1R",salt:"",username:"",passwordHash:"",pinHash:"",userLoggedIn:!1},xserver:{serverId:"",getUrl:"/req",postUrl:"/xserver"},sendServerUrl:"/xserver",sendLog:{req:"",resp:""},active:!1,ip:""};function b64ToBuf(t){var a=atob(t),n=a.length,r=new Uint8Array(n);for(i=0;i<n;i++)r[i]=a.charCodeAt(i);return r.buffer}function hex2buf(t){var a=t.match(/[\dA-F]{2}/gi).map(t=>parseInt(t,16));return new Uint8Array(a).buffer}xb.send=async function(t="",a=xb.sendServerUrl,n=""){if(!t||"object"!=typeof t||!Object.keys(t).length||Array.isArray(t)||!a)return!1;if(n){if("object"!=typeof n||Array.isArray(n))return!1;n.method||(n.method="POST"),n.headers||(n.headers={"Content-Type":"application/json; charset=utf-8"})}else n={method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"}};let r=new xb.Packet;return xb.makeKey(r).then(a=>xb.enc(JSON.stringify(t),a)).then(t=>{r.msg=t}).then(()=>xb.cert(r)).then(t=>(xb.sendLog.req=t,fetch(a,{method:n.method,headers:n.headers,body:JSON.stringify(t)}))).then(t=>t.json()).then(t=>(xb.sendLog.resp=t,t)).then(t=>xb.readPacketMsg(t))},xb.random=function(){let t=new Uint32Array(1);return self.crypto.getRandomValues(t)},xb.uuid=function(){return self.crypto.randomUUID()},xb.hash=async function(t,a=256){switch(a){case 1:a="SHA-1";break;case 2:default:a="SHA-256";break;case 384:case 3:a="SHA-384";break;case 512:case 5:a="SHA-512"}let n=new TextEncoder().encode(t),r=await crypto.subtle.digest(a,n),l=Array.from(new Uint8Array(r)),s=l.map(t=>t.toString(16).padStart(2,"0")).join("");return s},xb.cert=async function(t){let a=xb.secure.salt?xb.secure.salt:xb.secure.defaultSalt;if("string"!=typeof t.msg&&(t.msg=JSON.stringify(t.msg)),""==t.cert)return t.cert=await xb.hash(t.from+t.to+t.msg+t.id+t.active+a),t;{"string"!=typeof t.msg&&(t.msg=JSON.stringify(t.msg));let n=await xb.hash(t.from+t.to+t.msg+t.id+t.active+a);return t.cert==n}},xb.genKey=async function(t="aes"){if("rsa"==t)return await window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["encrypt","decrypt"]);if("hmac"==t){let a=await window.crypto.subtle.generateKey({name:"HMAC",hash:{name:"SHA-256"}},!0,["sign","verify"]);return a.export=await xb.exportKey(a,"hmac"),a}if("ecdsa"==t)return await crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-384"},!0,["sign","verify"]);if("aes"==t){let n=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return n.export=await xb.exportKey(n),n}},xb.encrypt=xb.enc=async function(t,a){let n=await crypto.subtle.importKey("raw",hex2buf(a),"AES-GCM",!1,["encrypt"]),r=crypto.getRandomValues(new Uint8Array(12)),l=await crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:128},n,new TextEncoder().encode(t));return xb.buffer2base64(r)+xb.buffer2base64(l)},xb.buffer2hex=function(t){let a=Array.from(new Uint8Array(t)),n=a.map(t=>t.toString(16).padStart(2,"0")).join("");return n},xb.buffer2base64=function(t){let a=String.fromCharCode.apply(null,new Uint8Array(t));return window.btoa(a)},xb.base64ToBuffer=function(t){return new Uint8Array(atob(t).split("").map(t=>t.charCodeAt(0)))},xb.buffer2utf8=function(t){return new TextDecoder("utf-8").decode(new Uint8Array(t))},xb.decrypt=xb.dec=async function(t,a){let n=b64ToBuf(t),r=new Uint8Array(n),l=r.subarray(0,12),s,o=await crypto.subtle.decrypt({name:"AES-GCM",iv:l},await crypto.subtle.importKey("raw",hex2buf(a),"AES-GCM",!1,["decrypt"]),r.subarray(12));return new TextDecoder().decode(o)},xb.exportKey=async function(t,a="aes"){if(!t||!a)return"ERROR! wrong input";{"priKey"==a&&(a="pkcs8"),"pubKey"==a&&(a="spki"),a.match(/aes|hmac/)&&(a="raw");let n=await window.crypto.subtle.exportKey(a,t);return xb.buffer2base64(n)}},xb.importKey=async function(t,a="aes"){let n=window.atob(t),r=new ArrayBuffer(n.length),l=new Uint8Array(r);for(i=0;i<n.length;i++)l[i]=n.charCodeAt(i);return"priKey"==a?window.crypto.subtle.importKey("pkcs8",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["decrypt"]):"pubKey"==a?window.crypto.subtle.importKey("spki",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]):a.match(/aes/)?crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt","decrypt"]):"hmac"==a?crypto.subtle.importKey("raw",r,{name:"HMAC",hash:"SHA-256"},!0,["sign","verify"]):void 0},xb.sign=async function(t,a,n="hmac"){"object"==typeof t&&(t=JSON.stringify(t));let r=new TextEncoder().encode(t);if("ecdsa"==n){let l=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-384"}},a,r);return xb.buffer2base64(l)}if("hmac"==n){try{a.match(/^[0-9a-zA-Z/=+]+$/)&&(a=await xb.importKey(a,"hmac"))}catch{}let s=await crypto.subtle.sign("HMAC",a,r);return xb.buffer2hex(s)}},xb.verify=async function(t,a,n,r="hmac"){if("object"==typeof t&&(t=JSON.stringify(t)),"ecdsa"==r)return await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-384"}},n,xb.base64ToBuffer(a),new TextEncoder().encode(t));if("hmac"==r){try{n.match(/^[0-9a-zA-Z/+=]+$/)&&(n=await xb.importKey(n,"hmac"))}catch{}return await crypto.subtle.verify("HMAC",n,hex2buf(a),new TextEncoder().encode(t))}},xb.uuidx=function(){let t=Date.now(),a=Date.now();for(;a==t;)a=Date.now();let n=a.toString();return n.slice(0,-5)+"-"+n.slice(-5)},xb.utf8ToBuffer=function(t){return new TextEncoder().encode(t)},xb.passKey=async function(t){let a=new TextEncoder().encode(t),n=await crypto.subtle.importKey("raw",a,"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:xb.utf8ToBuffer("xTKrg5fX-9l_"),iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])},xb.promptKey=async function(){return await xb.passKey(await xb.hash(prompt("password:")))},xb.promptHash=async function(){return xb.hash(prompt("words:"))},xb.randomWords=function(t=16){let a="";for(i=0;i<t;i++)a+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(52*Math.random()));return a},xb.password=function(t=12){let a="";for(i=0;i<t;i++)a+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$!~-+-*/\\|&%#@^.,:;<>(){}[]".charAt(Math.floor(89*Math.random()));return a},xb.pin=function(t=8){let a="";for(i=0;i<t;i++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".charAt(Math.floor(36*Math.random()));return a},xb.xDateCode=function(t){var a;a="string"==typeof t?t:"number"==typeof t?new Date(t).toString():new Date;let n={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12},r=a.toString().split(" ");return r[0].toUpperCase()+" "+r[3].slice(2)+"-"+n[r[1].toLowerCase()]+"-"+r[2]+" "+r[4].slice(0,5)},xb.vaultAdd=async function(t){if(!t||"object"!=typeof t||!Object.keys(t).length||Array.isArray(t))return{func:"xb.vaultAdd()",success:!1,msg:"wrong input"};for(label in t)if(""==t[label])return{func:"xb.vaultAdd()",success:!1,msg:"wrong label"};if(Object.keys(t).length>1){if(xb.vault){let a=await xb.promptHash(),n=JSON.parse(await xb.dec(xb.vault,a));for(label in t)label in n?console.log(`ERROR/vaultAdd: lebel '${label}' is already existed, skipped`):n[label]=t[label];xb.vault=await xb.enc(JSON.stringify(n),a)}else xb.vault=await xb.enc(JSON.stringify(t),await xb.promptHash())}else if(xb.vault){let r=await xb.promptHash(),l=JSON.parse(await xb.dec(xb.vault,r)),s=Object.keys(t);if(s in l)return{func:"xb.vaultAdd()",success:!1,msg:"label already existed, skipped"};l[s]=t[s],xb.vault=await xb.enc(JSON.stringify(l),r)}else xb.vault=await xb.enc(JSON.stringify(t),await xb.promptHash())},xb.vaultGet=async function(t){if(!t||"string"!=typeof t)return{func:"xb.vaultGet()",success:!1,msg:"wrong input, nothing done"};let a=JSON.parse(await xb.dec(xb.vault,await xb.promptHash()));return t in a?a[t]:{func:"xb.vaultGet()",success:!1,msg:"wrong label"}},xb.db=function(t){var a={};if(!t)return s();if(Object.keys(t)[0].match(/^_\w+$/)){if("_delete"==Object.keys(t)[0]){if(a=s(),"string"==typeof t._delete)delete a[t._delete],o();else{if("object"!=typeof t._delete)return"invalid input";let n=Object.keys(t._delete)[0],r=Object.keys(t._delete[n])[0],l=a[n].findIndex(a=>a[r]==t._delete[n][r]);a[n].splice(l,1),o()}}}else if(c()){for(col in a=s(),t)if(col in a){if(Array.isArray(t[col]))for(doc of t[col])doc._id=xb.uuidx(),a[col].push(doc);else t[col]._id=xb.uuidx(),a[col].push(t[col])}else if(a[col]=[],Array.isArray(t[col]))for(doc of t[col])doc._id=xb.uuidx(),a[col].push(doc);else t[col]._id=xb.uuidx(),a[col].push(t[col]);o()}else{for(col in t)if(a[col]=[],Array.isArray(t[col]))for(doc of t[col])doc._id=xb.uuidx(),a[col].push(doc);else t[col]._id=xb.uuidx(),a[col].push(t[col]);o()}function s(){return JSON.parse(localStorage.getItem("xdev_db"))}function o(){localStorage.setItem("xdev_db",JSON.stringify(a))}function c(){return localStorage.getItem("xdev_db")}},xb.atime=function(t="hour"){let a=new Date,n=a.getFullYear(),r=a.getMonth()>=10?a.getMonth():"0"+a.getMonth(),l=a.getDate()>=10?a.getDate():"0"+a.getDate(),s=a.getHours()>=10?a.getHours():"0"+a.getHours(),o=a.getMinutes()>=10?a.getMinutes():"0"+a.getMinutes(),c=0;switch(t){case"min":c=Date.parse(`${n}-${r}-${l}t${s}:${o}`);break;case"hour":c=Date.parse(`${n}-${r}-${l}t${s}:00`);break;case"day":c=Date.parse(`${n}-${r}-${l}`);break;case"week":c=Date.parse(`${n}-${r}-${l=(l=a.getDate()-a.getDay())>=10?l:"0"+l}`);case"month":c=Date.parse(`${n}-${r}`);break;case"year":c=Date.parse(`${n}`);break;default:return"wrong input"}return c},xb.acode=async function(t=24){switch(t){case 60:t="min";break;case 24:default:t="hour";break;case 31:t="day";break;case 7:t="week";break;case 12:t="month";break;case 365:t="year"}return await xb.hash(document.body+xb.atime(t))},xb.isJson=function(t){try{let a=JSON.parse(t);if("object"==typeof a)return!0;return!1}catch{return!1}},xb.isHex=function(t){return"string"==typeof t&&!!t.match(/^[0-9a-f]+$/i)},xb.readForm=function(t){let a=document.querySelector(t),n=a.elements,r={};for(i=0;i<n.length;i++){"radio"==n[i].type?"radio"!=n[i-1].type&&(r[n[i].name]=a[n[i].name].value+l()):"checkbox"==n[i].type?n[i].checked?""==r[n[i].name]||void 0==r[n[i].name]?r[n[i].name]=n[i].value:r[n[i].name]+=","+n[i].value:void 0==r[n[i].name]&&(r[n[i].name]=""):r[n[i].name]=n[i].value+l();function l(){return n[i].hasAttribute("_invalid")?"<invalid="+n[i].getAttribute("_invalid")+">":""}}for(i of(r._valid=!0,n))i.hasAttribute("_invalid")&&(r._valid=!1);return r},xb.readForm2=function(el_s,validRule={},noticeStyle="1px solid orange"){let outputx={};if(el_s instanceof HTMLFormElement)return work(el_s);if("string"==typeof el_s)return work(el_s=document.querySelector(el_s));{let re={func:"xb.readForm2",success:!1,msg:"wrong input, must be string or html element"};return XBROWSER.readFormLog=re,re}function work(el){for(e of(""==Object.keys(validRule)&&eval("validRule ="+el.getAttribute("_validRule")),null==validRule&&(validRule={}),el))if("textarea"==e.type)outputx[e.name]=e.value,xb.validate(outputx[e.name],validRule[e.name])?e.style.border==noticeStyle&&(e.style.border=""):(outputx[e.name]+="<invalid>",e.style.border=noticeStyle,outputx._invalid=!0);else if("radio"==e.type)e.name in outputx||(outputx[e.name]=el[e.name].value,xb.validate(outputx[e.name],validRule[e.name])?"DIV"==e.parentElement.tagName&&e.parentElement.hasAttribute("_input-frame")&&(e.parentElement.style.border=""):"DIV"==e.parentElement.tagName&&e.parentElement.hasAttribute("_input-frame")&&(outputx[e.name]="<invalid>",e.parentElement.style.border=noticeStyle,outputx._invalid=!0));else if("checkbox"==e.type){e.name in outputx?e.checked&&outputx[e.name].push(e.value):e.checked?outputx[e.name]=[e.value]:outputx[e.name]=[];let lastIndexOfCheckbox=el[e.name].length-1;e.value==el[e.name][lastIndexOfCheckbox].value&&(xb.validate(outputx[e.name],validRule[e.name])?"DIV"==e.parentElement.tagName&&e.parentElement.hasAttribute("_input-frame")&&(e.parentElement.style.border=""):"DIV"==e.parentElement.tagName&&e.parentElement.hasAttribute("_input-frame")&&(outputx[e.name]="<invalid",e.parentElement.style.border=noticeStyle,outputx._invalid=!0))}else"submit"!=e.type&&(e.disabled||(outputx[e.name]=e.value,xb.validate(outputx[e.name],validRule[e.name])?e.style.border==noticeStyle&&(e.style.border=""):(outputx[e.name]+="<invalid>",e.style.border=noticeStyle,outputx._invalid=!0)));return outputx}},xb.jsonify=function(t){return"object"==typeof t&&JSON.stringify(t)},xb.jparse=function(t){try{let a=JSON.parse(t);if("object"==typeof a)return a;return!1}catch{return!1}},xb.showData=async function(t,a,n){if(XBROWSER.showDataSpace||(XBROWSER.showDataSpace={data:t,toElement:a,opt:n,index:0}),t||(t=XBROWSER.showDataSpace.data),a||(a=XBROWSER.showDataSpace.toElement),n||(n=XBROWSER.showDataSpace.opt),"TABLE"==a.tagName){var r;let l="";if(n&&n.tableHeader?(n.tableHeader=n.tableHeader.split(" "),l+="<tr>",n.tableHeader.forEach(t=>{l+="<th>"+t+"</th>"}),l+="</tr>",a.innerHTML=l):r=!0,t){if(r){for(k in l+="<tr>",t[0])l+="<th>"+xb.toTitleCase(k)+"</th>";l+="</tr>"}t.forEach(t=>{for(k in l+="<tr>",t)l+="<td>"+t[k]+"</td>";l+="</tr>"}),a.innerHTML=l}}else if("SELECT"==a.tagName){let s="";t.forEach(t=>{s+="<option>"+t[Object.keys(t)[0]]+"</option>"}),a.innerHTML=s}else if(a.tagName?.match(/OL|UL/)){let o="";t.forEach(t=>{o+="<li>"+t[Object.keys(t)[0]]+"</li>"}),a.innerHTML=o}else if("FORM"==a.tagName){XBROWSER.showDataSpace.index||(XBROWSER.showDataSpace.index=0);let c=XBROWSER.showDataSpace.index;if(Array.isArray(t)){if(c<0)return XBROWSER.showDataSpace.index=0,!1;if(c>t.length-1)return XBROWSER.showDataSpace.index=t.length-1,!1;_showDataIndex.value=c+"/"+(t.length-1);for(el of(_goLeft.disabled=_goRight.disabled=_goMostLeft.disabled=_goMostRight.disabled=!1,a))"submit"==el.type||("date"==el.type?t[c][el.name]?.match(/^\d{4}-\d{2}-\d{2}/)?el.value=t[c][el.name]?.match(/^\d{4}-\d{2}-\d{2}/):el.value="":el.value=t[c][el.name])}else if("object"!=typeof t)return!1;else for(el of(_showDataIndex.value="0/0",a))el.value=t[el.name]}else{let b="";"object"!=typeof t||Array.isArray(t)||(t=[t]),t.forEach(t=>{b+="<table>";let a=1;var n="";for(key in t)1==a?b+=`<tr ${n}><td style="width:25%"><b>`+key+"</b></td><td><b>"+t[key]+"</b></td></tr>":(a>5&&(n="hidden"),b+=`<tr ${n}><td style="width:25%">`+key+"</td><td>"+t[key]+"</td></tr>"),a++;b+='</table><span style="font-size:20px;cursor:pointer;color:blue" onclick="xb.expandTable(this,this.previousSibling)" title="Click to expand or shrink this table.">+</span><br><br>'}),a.innerHTML=b}},xb.expandTable=function(t,a){if("+"==t.innerText){t.innerText="--",t.style.backgroundColor="yellow";a.querySelectorAll("[hidden]").forEach(t=>t.hidden=!1)}else if("--"==t.innerText)for(i=0,t.innerText="+",t.style.backgroundColor="";i<a.rows.length;i++)i>4&&(a.rows[i].hidden=!0)},xb.toTitleCase=xb.toTitle=function(t){let a=t.split(" ");for(i=0;i<a.length;i++){var n=a[i].charAt(0).toUpperCase();a[i]=n+a[i].slice(1)}return a.join("")},xb.toCamelCase=xb.toCamel=function(t){let a=t.split(" ");for(i=1;i<a.length;i++){var n=a[i].charAt(0).toUpperCase();a[i]=n+a[i].slice(1)}return a.join("")},xb.toSnakeCase=xb.toSnake=function(t){return t.replaceAll(" ","_")},xb.toDashCase=xb.toDash=function(t){return t.replaceAll(" ","-")},xb.validate=function(t,a){var n=!0;return!a||(a.split(";").forEach(a=>{if("required"!=(a=a.trim())||""!=t&&t||(n=!1),"wordsOnly"!=a||t.match(/^[a-zA-Z ]+$/)||(n=!1),a.match(/^length:(\d+)-(\d+)$/)){let r=a.match(/^length:(\d+)-(\d+)$/);(t.length<Number(r[1])||t.length>Number(r[2]))&&(n=!1)}if(a.match(/^value:(\d+)-(\d+)$/)){let l=a.match(/^value:(\d+)-(\d+)$/);(Number(t)<Number(l[1])||Number(t)>Number(l[2]))&&(n=!1)}if("1symbol"!=a||t.match(/[\-+*/._%^?\<\>\(\)$~!|\\= ]/)||(n=!1),"noSymbol"==a&&t.match(/[\-+*/._%^?\<\>\(\)$~!|\\= ]/)&&(n=!1),"1number"!=a||t.match(/\d/)||(n=!1),"numbersOnly"==a&&t.match(/\D/)&&(n=!1),"1capital"!=a||t.match(/[A-Z]/)||(n=!1),"capitalOnly"!=a||t.match(/^[A-Z]+$/)||(n=!1),"1small"!=a||t.match(/[a-z]/)||(n=!1),"smallOnly"!=a||t.match(/^[a-z]+$/)||(n=!1),"isoDate"==a){let s=t.split("-");3!=s.length&&(n=!1),s[0].length>4&&(n=!1),Number(s[1])>12&&(n=!1),Number(s[2])>31&&(n=!1)}"noSpace"==a&&t.match(/\s/)&&(n=!1),"2decimal"!=a||t.match(/^\d+.\d{1,2}$/)||(n=!1),"notNull"==a&&t.match(/^$/i)&&(n=!1)}),n)},xb.el=function(strin){return eval(`document.querySelector('${strin}')`)},xb.els=function(strin){return eval(`document.querySelectorAll('${strin}')`)},xb.tableCell=function(t,a,n){return t.rows[a].cells[n]},xb.tradeVal=function(t){let a=[];var n,r,l,s=!0;let o=[];if("string"!=typeof t&&(t=t.toString()),t.includes(".")?(a=t.split("."))[0].match(/^\d+$/)&&a[1].match(/^\d+$/)&&2==a.length?(n=!0,s=!0,r=a[0],l=a[1]):s=!1:t.match(/^\d+$/)&&(s=!0,n=!1,r=t),!s)return!1;for(;r;)o.unshift(r.slice(-3)),r=r.slice(0,-3);return n?(l=1==l.length?l.toString()+"0":l.match(/^\d{2}/).toString(),o.toString()+"."+l):o.toString()+".00"},xb.getIp=async function(){return fetch("https://api.ipify.org?format=json").then(t=>t.json()).then(t=>t.ip)},xb.Packet=class{from=xb.secure.sessionId;to=xb.xserver.serverId;active=xb.active;msg="";id=xb.ip+"_"+Date.now()+"_"+xb.uuid();cert=""},xb.makeKey=async function(t){return!!t&&"object"==typeof t&&!!t.from&&!!t.id&&xb.hash(t.from+t.to+t.id+xb.secure.defaultSalt+xb.secure.salt)},xb.passwordRealHash=async function(t,a){return xb.hash(t+a+"D+DHDqyDC~P9")},xb.readPacketMsg=async function(t){return xb.makeKey(t).then(a=>xb.dec(t.msg,a)).then(t=>JSON.parse(t))},xb.readPicFileAsDataUrl=async function(t){return new Promise((a,n)=>{let r=t.files[0],l=new FileReader;l.readAsDataURL(r),l.onloadend=()=>{a(l.result)},l.onerror=()=>{n(l.error)}})},xb.readTextFile=async function(t){return new Promise((a,n)=>{let r=t.files[0],l=new FileReader;l.readAsText(r),l.onload=()=>{a(l.result)},l.onerror=()=>{n(l.error)}})},xb.savePngFile=function(t,a){if(!t)return{msg:"Wrong input.",success:!1};a||(a=Date.now()+".png"),a.match(/\w+.png$/)||(a+=".png");let n=document.createElement("canvas");n.width=t.clientWidth,n.height=t.clientHeight;n.getContext("2d").drawImage(t,0,0),n.toBlob(t=>{let n=document.createElement("a");n.download=a,n.href=URL.createObjectURL(t),n.click(),URL.revokeObjectURL(n.href)},"image/png")},xb.saveTextFile=function(t,a){if(!t)return{msg:"Wrong input.",success:!1};a||(a=Date.now()+".txt"),a.match(/\w+.txt$/)||(a+=".txt");let n=document.createElement("a");n.download=a;let r=new Blob([t],{type:"text/plain"});n.href=URL.createObjectURL(r),n.click(),URL.revokeObjectURL(n.href)},xb.sel=function(t){var a=document.querySelector(t);if(a.sel=xb.sel2,a.selAll=xb.selAll2,a.add=xb.add,a.del=xb.del,a.hide=xb.hide,a.show=xb.show,a.toggle=xb.toggle,a.setHtml=xb.setHtml,"TABLE"==a.tagName&&(a.fillTable=xb.fillTable),"SELECT"==a.tagName&&(a.fillSelect=xb.fillSelect),a.tagName&&a.tagName.match(/OL|UL/)&&(a.fillList=xb.fillList),a.length)for(elemen of a)elemen.sel=xb.sel2,elemen.selAll=xb.selAll2,elemen.add=xb.add,elemen.del=xb.del,elemen.hide=xb.hide,elemen.show=xb.show,elemen.toggle=xb.toggle,elemen.setHtml=xb.setHtml,"TABLE"==elemen.tagName&&(elemen.fillTable=xb.fillTable),"SELECT"==elemen.tagName&&(elemen.fillSelect=xb.fillSelect),element.tagName&&elemen.tagName.match(/OL|UL/)&&(elemen.fillList=xb.fillList);return a},xb.selAll=function(t){var a=document.querySelectorAll(t);if(a.sel=xb.sel2,a.selAll=xb.selAll2,a.add=xb.add,a.del=xb.del,a.hide=xb.hide,a.show=xb.show,a.toggle=xb.toggle,a.setHtml=xb.setHtml,"TABLE"==a.tagName&&(a.fillTable=xb.fillTable),"SELECT"==a.tagName&&(a.fillSelect=xb.fillSelect),a.tagName&&a.tagName.match(/OL|UL/)&&(a.fillList=xb.fillList),a.length)for(elemen of a)elemen.sel=xb.sel2,elemen.selAll=xb.selAll2,elemen.add=xb.add,elemen.del=xb.del,elemen.hide=xb.hide,elemen.show=xb.show,elemen.toggle=xb.toggle,elemen.setHtml=xb.setHtml,"TABLE"==elemen.tagName&&(elemen.fillTable=xb.fillTable),"SELECT"==elemen.tagName&&(elemen.fillSelect=xb.fillSelect),elemen.tagName&&elemen.tagName.match(/OL|UL/)&&(elemen.fillList=xb.fillList);return a},xb.sel2=function(t){var a=this.querySelector(t);if(a.sel=xb.sel2,a.selAll=xb.selAll2,a.add=xb.add,a.del=xb.del,a.hide=xb.hide,a.show=xb.show,a.toggle=xb.toggle,a.setHtml=xb.setHtml,"TABLE"==a.tagName&&(a.fillTable=xb.fillTable),"SELECT"==a.tagName&&(a.fillSelect=xb.fillSelect),a.tagName&&a.tagName.match(/OL|UL/)&&(a.fillList=xb.fillList),a.length)for(elemen of a)elemen.sel=xb.sel2,elemen.selAll=xb.selAll2,elemen.add=xb.add,elemen.del=xb.del,elemen.hide=xb.hide,elemen.show=xb.show,elemen.toggle=xb.toggle,elemen.setHtml=xb.setHtml,"TABLE"==elemen.tagName&&(elemen.fillTable=xb.fillTable),"SELECT"==elemen.tagName&&(elemen.fillSelect=xb.fillSelect),elemen.tagName&&elemen.tagName.match(/OL|UL/)&&(elemen.fillList=xb.fillList);return a},xb.selAll2=function(t){var a=this.querySelectorAll(t);if(a.sel=xb.sel2,a.selAll=xb.selAll2,a.add=xb.add,a.del=xb.del,a.hide=xb.hide,a.show=xb.show,a.toggle=xb.toggle,a.setHtml=xb.setHtml,"TABLE"==a.tagName&&(a.fillTable=xb.fillTable),"SELECT"==a.tagName&&(a.fillSelect=xb.fillSelect),a.tagName&&a.tagName.match(/OL|UL/)&&(a.fillList=xb.fillList),a.length)for(elemen of a)elemen.sel=xb.sel2,elemen.selAll=xb.selAll2,elemen.add=xb.add,elemen.del=xb.del,elemen.hide=xb.hide,elemen.show=xb.show,elemen.toggle=xb.toggle,elemen.setHtml=xb.setHtml,"TABLE"==elemen.tagName&&(elemen.fillTable=xb.fillTable),"SELECT"==elemen.tagName&&(elemen.fillSelect=xb.fillSelect),elemen.tagName&&elemen.tagName.match(/OL|UL/)&&(elemen.fillList=xb.fillList);return a},xb.add=function(t){this.length?this.forEach(t=>{a(t)}):a(this);function a(a){if(t.class&&t.class.split(" ").forEach(t=>a.classList.add(t)),t.style)for(ky in t.style)a.style[ky]=t.style[ky];if(t.attri)for(ky in t.attri)a.setAttribute(ky,t.attri[ky])}},xb.del=function(t){this.length?this.forEach(n=>{t?a(n):n.remove()}):t?a(this):this.remove();function a(a){t.class&&t.class.split(" ").forEach(t=>a.classList.remove(t)),t.style&&t.style.split(" ").forEach(t=>a.style[t]=""),t.attri&&t.attri.split(" ").forEach(t=>a.removeAttribute(t))}},xb.hide=function(){this.length?this.forEach(t=>{t.hidden=!0}):this.hidden=!0},xb.show=function(){this.length?this.forEach(t=>{t.hidden=!1}):this.hidden=!1},xb.toggle=function(){this.length?this.forEach(t=>{!0==t.hidden?t.hidden=!1:t.hidden=!0}):!0==this.hidden?this.hidden=!1:this.hidden=!0},xb.setHtml=function(t){this.length?this.forEach(a=>a.innerHTML=t):this.innerHTML=t},xb.newEl=function(t){if(!t.tag)return!1;let a=document.createElement(t.tag);if(t.class&&(a.className=t.class),t.html&&(a.innerHTML=t.html),t.css&&(a.style.cssText=t.css),t.id&&a.setAttribute("id",t.id),t.name&&a.setAttribute("name",t.name),t.value&&a.setAttribute("value",t.value),t.hidden&&a.setAttribute("hidden",t.hidden),t.type&&a.setAttribute("type",t.type),t.title&&a.setAttribute("title",t.title),t.src&&a.setAttribute("src",t.src),t.attri)for(ky in t.attri)a.setAttribute(ky,t.attri[ky]);if(t.style)for(ky in t.style)a.style[ky]=t.style[ky];return a.appendTo=function(t){xb.sel(t).append(a)},a.prependTo=function(t){xb.sel(t).prepend(a)},a},xb.fillTable=function(t){if("TABLE"==this.tagName){let a="";if(t.head){a="<tr>";t.head.split(" ").forEach(t=>{a+="<th>"+t+"</th>"}),a+="</tr>"}else{let n=t.data[0];for(ky in a="<tr>",n)a+="<th>"+ky+"</th>";a+="</tr>"}t.data.forEach(t=>{for(ky in a+="<tr>",t)a+="<td>"+t[ky]+"</td>";a+="</tr>"}),this.innerHTML=a}},xb.fillSelect=function(t){if("SELECT"==this.tagName){let a="";t.forEach(t=>{a+="<option>"+t+"</option>"}),this.innerHTML=a}},xb.fillList=function(t){if(this.tagName&&this.tagName.match(/OL|UL/)){let a="";t.forEach(t=>{a+="<li>"+t+"</li>"}),this.innerHTML=a}},xb.sort=function(t,a="asc",n=""){return!!Array.isArray(t)&&(t.sort((t,r)=>{if("asc"==a)return n?t[n]<r[n]?-1:t[n]>r[n]?1:0:t<r?-1:t>r?1:0;if("des"==a)return n?t[n]<r[n]?1:t[n]>r[n]?-1:0:t<r?1:t>r?-1:0}),t)},xb.sess={},xb.sess.r=async function(t=""){if(t){if("string"!=typeof t)return!1;{let a=sessionStorage.getItem("sess");return a?t in(a=JSON.parse(await xb.dec(a,await xb.masterKey())))&&a[t]:null}}{let n=sessionStorage.getItem("sess");return n?n=JSON.parse(await xb.dec(n,await xb.masterKey())):null}},xb.sess.w=async function(t=""){if(!t||"object"!=typeof t||Array.isArray(t))return!1;if(Object.keys(t).length){let a=sessionStorage.getItem("sess");if(a){for(keyx in a=JSON.parse(await xb.dec(a,await xb.masterKey())),t)a[keyx]=t[keyx];return sessionStorage.setItem("sess",await xb.enc(JSON.stringify(a),await xb.masterKey())),!0}for(keyx in a={},t)a[keyx]=t[keyx];return sessionStorage.setItem("sess",await xb.enc(JSON.stringify(a),await xb.masterKey())),!0}},xb.sess.c=function(){return sessionStorage.removeItem("sess"),!sessionStorage.getItem("sess")},xb.masterKey=async function(){return await xb.hash(xb.secure.sessionId+navigator.userAgent+location.host+xb.secure.defaultSalt)},xb.getIp().then(t=>xb.ip=t);