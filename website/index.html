<!DOCTYPE html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
  /* standard elements */
  body {margin:0; padding:0}
  * {font-family: sans-serif;}
  p, input, textarea, select, li, button, label {font-size: 130%}

  /* custom elements */
  content {display: block; margin:0}
  content h1 {color:RosyBrown}
  
  alert {cursor: pointer;}
  basket {cursor: pointer}
  /*alert:hover {border:1px solid lightgray}*/

  menu {z-index: 30;}
  menu-item {font-size:36px; position:; left:0}

  card {display:block}
  card-name {cursor: pointer;}
  card-name:hover {background-color: lightgray;}
  vendor-logo {cursor:pointer}
  pic-frame {display:block; position:relative}
  pic-mark {position:absolute; top:8px; left:8px}




  /* class */


</style>

<!--load scripts here-->
<script src="/xbrowser/module/xdev/xdev_b2.js"></script>
<script src="/xbrowser/library/md5/md5.min.js"></script>
</head>

<body>


<!-- content -->
<content>

  <!-- sample product -->
  <card partNum="3000">
    <pic-frame>
      <img src="./pic/latte.jpg" style="width:100%; cursor: pointer;" onclick="toggleDisplay(this.parentElement.querySelector('check')); bas_ket.style.display='inline'">
      <pic-mark class="w3-xxlarge w3-opacity w3-text-gray">#3000</pic-mark>
      <check class="fa fa-check-circle w3-xxxlarge w3-text-white" style="position:absolute; right:8px; bottom:8px; display:none"></check>
    </pic-frame>

    <div class="w3-container">
      <card-name class="w3-xxlarge" title="Click to see product's detail.">Hot latte</card-name> &nbsp; <vendor-logo class="fa fa-odnoklassniki-square w3-xlarge" title="Click to see vendor's detail."></vendor-logo> &nbsp; <span class="w3-tag w3-small w3-red">HOT</span> <span class="w3-tag w3-small w3-blue">THB 75.00</span> &nbsp;&nbsp; <star class="fa fa-star w3-xlarge"></star><star class="fa fa-star w3-xlarge"></star><star class="fa fa-star w3-xlarge"></star><star-half class="fa fa-star-half-o w3-xlarge"></star-half><br>
      <card-brief class="w3-large">A cup of coffee for you whatever the time is, this coffee cup is waiting for you, ... at our cafe'</card-brief> &nbsp; <order class="w3-tag w3-gray" style="cursor: pointer;" title="Click to order this product.">ORDER</order>
    </div><br><br>
  </card>

  <card>
    <pic-frame>
      <img src="./pic/noodle.jpeg" style="width:100%; cursor: pointer;" onclick="toggleDisplay(this.parentElement.querySelector('check'))">
      <pic-mark class="w3-xxlarge w3-opacity w3-text-gray">#4300</pic-mark>
      <check class="fa fa-check-circle w3-xxxlarge w3-text-white" style="position:absolute; right:8px; bottom:8px; display:none"></check>
    </pic-frame>
    <div class="w3-container">
      <card-name class="w3-xxlarge">Yen Ta Foh</card-name> &nbsp; <span class="w3-tag w3-small w3-blue">THB 55.00</span> <span class="w3-tag w3-small w3-orange">RUNNING OUT OF STOCK</span> &nbsp;&nbsp; <star class="fa fa-star w3-xlarge"></star><br>
      <card-brief class="w3-large">Another very best taste of Thai Foods but this one transfered from Chinese. The taste is adapted to Thai style since long long ago. Can't miss.</card-brief>
    </div><br><br>
  </card>

  <card>
    <pic-frame>
      <img src="./pic/cake.jpg" style="width:100%; cursor: pointer;" onclick="toggleDisplay(this.parentElement.querySelector('check'))">
      <pic-mark class="w3-xxlarge w3-text-gray w3-opacity">#5100</pic-mark>
      <check class="fa fa-check-circle w3-xxxlarge w3-text-white" style="position:absolute; right:8px; bottom:8px; display:none"></check>
    </pic-frame>
    <div class="w3-container">
      <card-name class="w3-xxlarge">Brownie that never brown like this</card-name> &nbsp; <span class="w3-tag w3-small w3-blue">THB 120.00</span> <span class="w3-tag w3-small w3-yellow">NEW</span><br>
      <card-brief class="w3-large">You never seen this kind of brownies before I guarantee. This is one of the best of your chances. Jump!</card-brief>
    </div><br><br>
  </card>
</content>





<!-- top right corner -->

<logo class="fa fa-spinner w3-spin" style="position:fixed; top:4px; right:4px; font-size:36px; color:orangered; z-index:30" onclick="ale_rt.style.display='inline'"></logo>

<basket id="bas_ket" class="fa fa-shopping-basket w3-text-pink" style="position:fixed; top:4px; right:180px; font-size:30px; display:none"> 100</basket>

<alert id="ale_rt" class="fa fa-exclamation w3-text-yellow" style="position:fixed; top:4px; right: 100px; font-size:30px; display:none" onclick="mes_sage.hidden=false"> 6</alert>




<!-- menu icon & menu box -->

<menu-icon class="fa fa-caret-right w3-xxxlarge w3-btn w3-text-yellow" style="position:fixed; left:4px; top:50%; padding-left:4px; padding-right:4px;" onclick="me_nu.hidden=false"></menu-icon>



<div id="me_nu" class="w3-bar-block w3-gray" style="width:80%; position:fixed; left:0; bottom:0; z-index: 30" hidden>
  <menu-item class="w3-bar-item w3-button w3-padding-24" 
    onclick="loadLoginForm(); me_nu.hidden=true"><i class="fa fa-sign-in"></i> &nbsp; Log in</menu-item>
  
    <menu-item class="w3-bar-item w3-button w3-padding-24"><i class="fa fa-coffee"></i> &nbsp; Products</menu-item>
  <menu-item class="w3-bar-item w3-button w3-padding-24"><i class="fa fa-dollar"></i> &nbsp; Sales</menu-item>
  <menu-item class="w3-bar-item w3-button w3-padding-24"><i class="fa fa-line-chart"></i> &nbsp; My business</menu-item>
  <menu-item class="w3-bar-item w3-button w3-padding-24"><i class="fa fa-male"></i> &nbsp; My profile</menu-item>
  <hr>
  <menu-item class="w3-bar-item w3-button w3-padding-24"><i class="fa fa-sign-out"></i> &nbsp; Log out</menu-item>
  <menu-item class="w3-bar-item w3-button w3-padding-24" onclick="me_nu.hidden=true"><i class="fa fa-close"></i> &nbsp; Close</menu-item>
</div>


<!-- quick tools at lower part of the screen -->
<search class="fa fa-search w3-text-gray" style="position:fixed; left:40px; bottom:60px; font-size:46px; cursor:pointer; margin-top:8px" onclick="toggleDisplay(search_box)"></search> 

<input id="search_box" class="w3-input w3-border w3-black w3-round-xxlarge" type="text" style="position:fixed; left:100px; bottom:60px; width:350px; display:none; border:1px solid black" placeholder="Fill words & enter to search." onchange="alert(search_box.value)">  


  <!--
  <i class="fa fa-share-alt" style="font-size:46px; color:lightgray; cursor:pointer; margin-left:50px"></i><i class="fa fa-comment-o" style="font-size:46px; color:lightgray; cursor:pointer; margin-left:50px"></i>
  -->


<!-- message box -->

<message id="mes_sage" class="w3-panel w3-pale-green w3-card-4" style="position:fixed; width:80%; left:10%; bottom:20%" hidden>
  <msg-label class="w3-tag w3-blue w3-small" style="display:inline-block; left:0; margin-left:0; position:relative">NORMAL</msg-label>
  <h1>Title of message</h1>
  <p>This is the message that is showing when the user clicks on the alert icon or when the app tells something important to the user.</p>
  <br><br>

  <div style="text-align:;">
    <button class="w3-btn w3-lightgray" style="background-color: lightgray; padding:8px 16px" onclick="mes_sage.hidden=true; ale_rt.style.display='none'">Close</button><br><br>
  </div>
</message>





<script>
////////////////////////////////////////////////////////////////////
async function init() {
    if (!XB.secure.sessionId) {
        XB.secure.sessionId = XB.uuid()
        sessionStorage.setItem('sessionId', XB.secure.sessionId)
        
        if (!XB.ip) {
            XB.ip = await XB.getIp()
        } 
        let re = await XB.$({send:{act:'new_session'}})
        
        //certify the packet
        if (await XB.cert(re)) {
          //packet is certified

          //unwrap msg
          let msg = await XB.dec(re.msg, await XB.makeKey(re))
          //console.log(msg)

          if (XB.isJson(msg)) {
            msg = JSON.parse(msg)
          }

          //set values
          XB.active = re.active
          XB.xserver.serverId = re.from
          XB.secure.salt = msg.yourNewSalt
          sessionStorage.setItem('active', true)
          sessionStorage.setItem('serverId', re.from)
          sessionStorage.setItem('salt', msg.yourNewSalt)

          console.log('everything done!')

        } else {
          console.log('the resp not certified')
        }
    
      } else {
        //has sessionId
        XB.active = true
        XB.secure.sessionId = sessionStorage.getItem('sessionId')
        XB.xserver.serverId = sessionStorage.getItem('serverId')
        XB.secure.salt = sessionStorage.getItem('salt')
    }
}
init()    

const userInfo = {
  username: '', passwordHash: ''
}

async function login() {
  userInfo.username = user_name.value,
  userInfo.passwordHash = await XB.passwordRealHash(
    userInfo.username, 
    userInfo.passwordHash
  )

  XB.$({
    send: {
      act:          'log_in',
      username:     userInfo.username,
      passwordHash: userInfo.passwordHash
    }

  }).then(re => {
    return XB.makeKey(re).then(gotKey => {
      return XB.dec(
        re.msg,
        gotKey
      )
    })

  }).then(msg => {
    //console.log(msg)
    msg = JSON.parse(msg)

    if (msg.log_in) {
      XB.el('content').innerHTML = msg.content
    } else {
      XB.el('content').innerHTML = msg.content
    }
  })
  //console.log(userInfo)
}



function loadLoginForm() {
  console.log('load login form')

  XB.$({send:
    { act:'load_login_content'  }

  }).then(respPacket => {
    return XB.readPacketMsg(respPacket)
  }).then(msg => {
    console.log(msg)
    XB.el('content').innerHTML = msg.content
  })
}


function toggleDisplay(el) {
  //toggle any element's display to 'none' & 'inline'
  if (el.style.display == 'none') {
    el.style.display = 'inline'
  } else {
    el.style.display = 'none'
  }
}







</script>
</body>
</html>
